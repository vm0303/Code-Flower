{% extends "main/_base.html" %}
{% load custom_tags %}

{% block body%}

<style>
    .summary-grid {
        text-align: center;
        display: grid;
        grid-template-columns: minmax(20%,30%) minmax(20%,30%) minmax(20%,30%);
        column-gap: 5%;
        row-gap: 5%;
        justify-items: stretch;
    }
    .added {
        padding: 1rem;
        border-radius: 5px;
    }

    .add-topics {
        text-align: center;
        padding-bottom: 2%;
    }
</style>

<div class="container">
    <div class="account-info">
        <div class="card black white-text" >
            <h3 style="padding: 1rem">Instructor | Account Summary</h3>
        </div>
        <div class="summary-grid">
            <div class="added card">
                <i class="large material-icons">book</i>
                <p>Topics added</p>
                <button class="btn modal-trigger" id="added-topics" data-target="all-topics">View</button>
            </div>
            <div class="added card">
                <i class="large material-icons">format_list_bulleted</i>
                <p>Lessons added</p>
                <button class="btn modal-trigger" id="added-lessons" data-target="all-lessons">View</button>
            </div>
            <div class="added card">
                <i class="large material-icons">code</i>
                <p>Quizzes added</p>
                <button class="btn modal-trigger" id="added quizzes" data-target="all-quizzes">View</button>
            </div>
        </div>
    </div>
    <div class="add-topics card">
        <h4 style="padding: 1rem">Add new topics here</h4>
            <button data-target="add-topics"  class="btn-floating large modal-trigger">
                <i class="large material-icons">add</i>
            </button>
    </div>
    <div id="topics-data">
        {% for topic in topics reversed %}
            <div class="card">
                <p style="padding: 1rem; display: inline-block">{{ topic.name }}</p>
                <a href="{% url 'edit_topic' topic.id %}">
                    <button class="btn-floating" style="float:right">
                        <i class="material-icons">edit</i>
                    </button>
                </a>
                <button class="btn-floating red" style="float:right">
                    <i class="material-icons">check_box</i>
                </button>
            </div>
        {% endfor %}
    </div>
    </div>
    <div id="add-topics" class="modal">
        <div class="modal-content">
          <h4>Add a new topic</h4>
            <label for="topicname">Topic Name</label>
            <input type="text" id="topicname"><br><br>
            <label for="min-score" style="display: block" >Minimum passing score</label>
            <input type="number" id="min-score" style="width: 25%"  min="0" max="100"><br><br>
            <label for="publish">
                <input type="checkbox" id="publish" name="accept" value="true"/>
                <span>Publish</span>
            </label>
        </div>
        <div class="modal-footer">
            <button class="btn modal-close red" >Cancel</button>
            <button class="btn modal-close" onclick="addTopic()">Add</button>
        </div>
    </div>

    <div id="all-topics" class="modal">
        <div class="modal-content">
          <h4>All topics</h4>
            <hr>
            {% for topic in topics reversed %}
            <div class="card">
                <p style="padding: 1rem; display: inline-block">{{ topic.name }}</p>
            </div>
        {% endfor %}
        </div>
        <div class="modal-footer">
            <button class="btn modal-close red" >Close</button>
        </div>
    </div>

    <div id="all-lessons" class="modal">
        <div class="modal-content">
          <h4>All lessons</h4>
            <hr>
            {% for lesson in lessons reversed %}
            <div class="card">
                <p style="padding: 1rem; display: inline-block">{{ lesson.name }}</p>
            </div>
        {% endfor %}
        </div>
        <div class="modal-footer">
            <button class="btn modal-close red" >Close</button>
        </div>
    </div>

    <div id="all-quizzes" class="modal">
        <div class="modal-content">
          <h4>All quizzes</h4>
            <hr>
            {% for quiz in quizzes reversed %}
            <div class="card">
                <p style="padding: 1rem; display: inline-block">{{ quiz.name }}</p>
            </div>
        {% endfor %}
        </div>
        <div class="modal-footer">
            <button class="btn modal-close red" >Close</button>
        </div>
    </div>

<script>

    function addTopic() {
        const topic = $('#topicname').val();
        const passScore = $('#min-score').val();
        let publish;
        if($('#publish:checked').val() == null) publish = 'False';
        else publish = 'True';

        $.ajax({
            method: "POST",
            url: "{% url 'create_topic' %}",
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            data: {
                'topic': topic,
                'min_passing_score': passScore,
                'published': publish
            },
            success: function (data) {
                $('#topics-data').html(data);
            },
            error: function () {
                alert('Cannot add new topic at this time');
            }
        });
    }

    $(document).ready(function(){
        $('.modal').modal();
    });

    $(document).ready(function(){
        $('.collapsible').collapsible();
    });
</script>
{% endblock %}
